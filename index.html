<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover" />
  <title>ç´å“æ›¸ | æ¾„å’Œå‰µè—åˆåŒä¼šç¤¾</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Noto+Sans+JP:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f8f6f2; --card:#fff; --text:#1a1612; --muted:#7c7168;
      --line:#e8e3db; --accent:#8b6f4e; --accent2:#c9a97a; --deep:#3d2b1f;
      --shadow:0 4px 24px rgba(60,40,20,.07);
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
    html,body{width:100%;max-width:100%;}
    body{font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--text);-webkit-text-size-adjust:100%;min-height:100vh;}

    /* LOGIN */
    #loginScreen{position:fixed;inset:0;z-index:1000;background:var(--deep);display:flex;align-items:center;justify-content:center;flex-direction:column;padding:24px;transition:opacity .6s ease,transform .6s ease;}
    #loginScreen.hide{opacity:0;pointer-events:none;transform:translateY(-16px);}
    .login-deco{position:absolute;inset:0;overflow:hidden;pointer-events:none;}
    .login-deco::before{content:'';position:absolute;top:-40%;left:-20%;width:600px;height:600px;border-radius:50%;background:radial-gradient(circle,rgba(201,169,122,.12) 0%,transparent 70%);}
    .login-deco::after{content:'';position:absolute;bottom:-30%;right:-10%;width:400px;height:400px;border-radius:50%;background:radial-gradient(circle,rgba(139,111,78,.10) 0%,transparent 70%);}
    .login-box{position:relative;z-index:1;width:100%;max-width:420px;text-align:center;animation:fadeUp .8s ease both;}
    @keyframes fadeUp{from{opacity:0;transform:translateY(24px);}to{opacity:1;transform:translateY(0);}}
    .login-logo{height:52px;width:auto;display:block;margin:0 auto 20px;filter:brightness(0) invert(1) opacity(.9);}
    .login-title{font-family:'Cormorant Garamond',serif;font-size:28px;font-weight:400;color:#f0ebe3;letter-spacing:2px;margin-bottom:6px;}
    .login-subtitle{font-size:11px;color:rgba(240,235,227,.4);letter-spacing:2px;text-transform:uppercase;margin-bottom:40px;}
    .login-field{position:relative;margin-bottom:14px;}
    .login-field input{width:100%;background:rgba(255,255,255,.06);border:1px solid rgba(201,169,122,.3);border-radius:14px;padding:16px 48px 16px 20px;font-size:15px;color:#f0ebe3;font-family:'Noto Sans JP',sans-serif;letter-spacing:2px;outline:none;transition:border-color .2s,background .2s;}
    .login-field input::placeholder{color:rgba(240,235,227,.25);letter-spacing:0;}
    .login-field input:focus{border-color:rgba(201,169,122,.7);background:rgba(255,255,255,.09);}
    .toggle-pw{position:absolute;right:14px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:rgba(240,235,227,.4);font-size:18px;padding:4px;}
    .login-btn{width:100%;background:linear-gradient(135deg,var(--accent2) 0%,var(--accent) 100%);border:none;border-radius:14px;padding:16px;font-size:15px;font-weight:700;color:#fff;cursor:pointer;letter-spacing:2px;font-family:'Noto Sans JP',sans-serif;transition:opacity .2s,transform .15s;box-shadow:0 4px 20px rgba(139,111,78,.35);}
    .login-btn:active{transform:translateY(1px);opacity:.9;}
    .login-error{margin-top:12px;font-size:13px;color:#e8917a;min-height:20px;}
    .login-hint{margin-top:36px;font-size:11px;color:rgba(240,235,227,.2);line-height:1.8;}

    /* MAIN */
    #mainApp{opacity:0;transition:opacity .5s ease .1s;}
    #mainApp.show{opacity:1;}
    .wrap{max-width:1140px;margin:0 auto;padding:20px 16px 72px;}

    .topbar{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:20px;padding-bottom:20px;border-bottom:1px solid var(--line);}
    .brand{display:flex;align-items:center;gap:16px;}
    .logo{height:44px;width:auto;display:block;}
    .brand-text h1{font-family:'Cormorant Garamond',serif;font-size:28px;font-weight:600;letter-spacing:1px;color:var(--deep);line-height:1.1;}
    .brand-text .sub{color:var(--muted);font-size:12px;margin-top:2px;letter-spacing:.3px;}
    .actions{display:flex;gap:8px;flex-wrap:wrap;align-items:center;}

    button{border:1px solid var(--line);background:#fff;padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:700;font-size:13px;font-family:'Noto Sans JP',sans-serif;color:var(--text);transition:background .15s,transform .1s;-webkit-tap-highlight-color:transparent;}
    button:hover:not(:disabled){background:#f5f0e8;}
    button.primary{background:linear-gradient(135deg,var(--accent2) 0%,var(--accent) 100%);border-color:transparent;color:#fff;box-shadow:0 3px 14px rgba(139,111,78,.3);}
    button.primary:hover:not(:disabled){opacity:.92;background:linear-gradient(135deg,var(--accent2) 0%,var(--accent) 100%);}
    button:disabled{opacity:.5;cursor:not-allowed;}
    button:active:not(:disabled){transform:translateY(1px);}
    .btn-mini{padding:9px 14px;border-radius:10px;font-weight:800;}
    .hint{font-size:12px;color:var(--muted);}

    .send-banner{background:linear-gradient(135deg,#fdf8f2 0%,#f8f2e8 100%);border:1px solid var(--accent2);border-radius:18px;padding:18px 22px;margin-bottom:16px;display:flex;align-items:center;gap:18px;flex-wrap:wrap;box-shadow:0 2px 12px rgba(139,111,78,.08);}
    .send-banner-icon{font-size:30px;flex-shrink:0;}
    .send-banner-body{flex:1;min-width:200px;}
    .send-banner-body strong{display:block;font-size:14px;font-weight:900;color:var(--deep);margin-bottom:5px;}
    .send-banner-body p{font-size:13px;color:var(--muted);line-height:1.8;margin:0;}
    .send-banner-body a{color:var(--accent);font-weight:700;text-decoration:none;border-bottom:1px solid rgba(139,111,78,.3);transition:color .15s;}
    .send-banner-body a:hover{color:var(--deep);}
    .send-banner-actions{display:flex;gap:8px;flex-wrap:wrap;align-items:center;}
    .copy-btn{font-size:12px;padding:8px 14px;border-radius:9px;font-weight:800;background:#fff;border:1px solid var(--accent2);color:var(--accent);cursor:pointer;font-family:'Noto Sans JP',sans-serif;transition:background .15s;}
    .copy-btn:hover{background:#fdf8f2;}
    .copy-btn.copied{color:#059669;border-color:#a7f3d0;background:#ecfdf5;}

    .grid{display:grid;grid-template-columns:minmax(300px,390px) 1fr;gap:16px;align-items:start;}
    @media(max-width:900px){.grid{grid-template-columns:1fr;}}
    .card{background:var(--card);border:1px solid var(--line);border-radius:20px;padding:20px;box-shadow:var(--shadow);}
    .sec-title{display:flex;align-items:baseline;justify-content:space-between;gap:12px;flex-wrap:wrap;border-bottom:1px solid var(--line);padding-bottom:12px;margin-bottom:16px;}
    .sec-title h2{font-family:'Cormorant Garamond',serif;font-size:20px;font-weight:600;color:var(--deep);letter-spacing:.5px;}
    .small{font-size:12px;color:var(--muted);}
    .row{display:grid;grid-template-columns:130px 1fr;gap:8px;align-items:center;margin:9px 0;}
    .row label{color:var(--muted);font-size:12px;font-weight:700;letter-spacing:.3px;}
    input,textarea,select{width:100%;min-width:0;border:1px solid var(--line);border-radius:10px;padding:10px 13px;font-size:15px;background:#fdfcfa;color:var(--text);font-family:'Noto Sans JP',sans-serif;transition:border-color .15s,box-shadow .15s;outline:none;}
    input:focus,textarea:focus,select:focus{border-color:var(--accent2);box-shadow:0 0 0 3px rgba(201,169,122,.12);}
    textarea{min-height:72px;resize:vertical;}
    input[type="date"]{max-width:100%;width:100%;min-width:0;-webkit-appearance:none;appearance:none;}
    .dest-box{border:1px solid var(--line);border-radius:10px;padding:10px 14px;background:#fdfcfa;}
    .dest-name{font-weight:900;font-size:14px;color:var(--deep);}
    .dest-addr{margin-top:5px;color:var(--muted);font-size:12px;line-height:1.7;white-space:pre-line;}
    .pill{display:flex;gap:8px;align-items:center;flex-wrap:wrap;padding:12px 14px;border:1px dashed var(--accent2);border-radius:14px;background:linear-gradient(135deg,#fdf8f2 0%,#faf5ee 100%);margin-top:12px;}
    .footer-note{margin-top:14px;color:var(--muted);font-size:12px;line-height:1.8;}

    .table-wrap{border:1px solid var(--line);border-radius:14px;background:#fff;overflow-x:auto;-webkit-overflow-scrolling:touch;}
    table{width:100%;border-collapse:collapse;background:#fff;table-layout:fixed;}
    col.no{width:52px;} col.unit{width:115px;} col.qty{width:86px;} col.amount{width:126px;} col.del{width:62px;} col.name{width:auto;}
    thead th{background:linear-gradient(to bottom,#f8f5f0,#f2ede6);color:var(--deep);font-weight:900;font-size:12px;padding:11px 8px;border-bottom:1px solid var(--line);white-space:nowrap;letter-spacing:.3px;}
    tbody td{border-bottom:1px solid var(--line);padding:8px;vertical-align:middle;font-size:14px;overflow:hidden;}
    tbody tr:last-child td{border-bottom:none;}
    tbody tr:hover td{background:#fdfaf6;}
    .num{text-align:right;font-variant-numeric:tabular-nums;}
    .center{text-align:center;}
    td input{width:100%;min-width:0;padding:7px 10px;font-size:14px;border-radius:8px;}
    td.unitcell input,td.qtycell input{text-align:right;}
    .table-actions{margin-top:10px;display:flex;justify-content:center;}
    .table-actions button{padding:11px 20px;border-radius:12px;font-weight:900;}

    .sum{margin-top:14px;display:grid;grid-template-columns:1fr 300px;gap:14px;align-items:start;}
    @media(max-width:900px){.sum{grid-template-columns:1fr;}}
    .sum-box{border:1px solid var(--line);border-radius:16px;padding:14px;background:linear-gradient(135deg,#fdf8f2 0%,#fff 100%);box-shadow:var(--shadow);}
    .sum-row{display:flex;justify-content:space-between;gap:12px;padding:9px 0;border-bottom:1px solid var(--line);font-variant-numeric:tabular-nums;}
    .sum-row:last-child{border-bottom:none;}
    .sum-row .k{color:var(--muted);font-size:13px;font-weight:700;}
    .sum-row .v{font-weight:900;font-size:14px;color:var(--deep);}
    .sum-row.grand .k{color:var(--deep);font-size:14px;font-weight:900;}
    .sum-row.grand .v{font-size:17px;color:var(--accent);}
    .mode-badge{display:inline-block;font-size:11px;font-weight:800;padding:3px 10px;border-radius:20px;background:#e8f4f4;color:#0e8a8a;letter-spacing:.3px;}
    .mode-badge.taxex{background:#fff3e0;color:#c07000;}
    .mode-badge.totalnone{background:#f0ebff;color:#6b3fa0;}

    /* Mobile */
    body.is-mobile .row{grid-template-columns:1fr;gap:4px;align-items:stretch;margin:10px 0;}
    body.is-mobile .row label{font-size:12px;font-weight:700;}
    body.is-mobile .table-wrap{overflow:visible;border:0;background:transparent;}
    body.is-mobile table{min-width:0;background:transparent;}
    body.is-mobile table,body.is-mobile thead,body.is-mobile tbody,body.is-mobile tr,body.is-mobile td{display:block;width:100%;}
    body.is-mobile thead{display:none;}
    body.is-mobile tbody tr{background:#fff;border:1px solid var(--line);border-radius:16px;padding:14px;margin:10px 0;box-shadow:var(--shadow);}
    body.is-mobile tbody td{border-bottom:0;padding:6px 0;overflow:visible;}
    body.is-mobile tbody td:nth-child(1){padding-top:0;font-weight:900;color:var(--deep);display:flex;justify-content:center;}
    body.is-mobile tbody td:nth-child(2)::before{content:"å“å / ä½œå“å";display:block;color:var(--muted);font-weight:800;font-size:12px;margin-bottom:6px;}
    body.is-mobile tbody td:nth-child(3),body.is-mobile tbody td:nth-child(4),body.is-mobile tbody td:nth-child(5),body.is-mobile tbody td:nth-child(6){display:flex;align-items:center;justify-content:space-between;gap:12px;}
    body.is-mobile tbody td:nth-child(3)::before{content:"å˜ä¾¡";color:var(--muted);font-weight:800;font-size:12px;}
    body.is-mobile tbody td:nth-child(4)::before{content:"æ•°é‡";color:var(--muted);font-weight:800;font-size:12px;}
    body.is-mobile tbody td:nth-child(5)::before{content:"é‡‘é¡";color:var(--muted);font-weight:800;font-size:12px;}
    body.is-mobile tbody td:nth-child(6)::before{content:"å‰Šé™¤";color:var(--muted);font-weight:800;font-size:12px;}
    body.is-mobile tbody td:nth-child(3) input,body.is-mobile tbody td:nth-child(4) input{width:60%;text-align:right;}
    body.is-mobile tbody td:nth-child(5){padding-top:10px;border-top:1px dashed var(--line);margin-top:6px;}
    body.is-mobile .amount{font-weight:950;}
    body.is-mobile tbody td:nth-child(6) button{padding:10px 14px;border-radius:12px;}
    body.is-mobile input[type="date"]{width:100%;max-width:100%;display:block;}

    /* Print */
    @page{size:A4;margin:12mm;}
    @media print{
      body{background:#fff;}
      #loginScreen{display:none !important;}
      .wrap{max-width:none;padding:0;}
      .actions,.pill,.table-actions,.footer-note,.send-banner{display:none !important;}
      .card{box-shadow:none;border:0;border-radius:0;padding:0;}
      .grid{display:block !important;}
      .topbar{margin-bottom:14px;border-bottom:1px solid #ccc;padding-bottom:10px;}
      .table-wrap{border:1px solid #aaa;border-radius:0;overflow:visible !important;background:#fff !important;}
      table{display:table !important;width:100% !important;border-collapse:collapse !important;table-layout:fixed !important;min-width:0 !important;}
      col.no{width:38px !important;} col.unit{width:100px !important;} col.qty{width:65px !important;} col.amount{width:115px !important;} col.del{width:0 !important;display:none !important;}
      thead{display:table-header-group !important;} tbody{display:table-row-group !important;}
      tr{display:table-row !important;page-break-inside:avoid !important;}
      th,td{display:table-cell !important;} td::before{content:none !important;}
      tbody tr{box-shadow:none !important;border:0 !important;border-radius:0 !important;padding:0 !important;margin:0 !important;background:#fff !important;}
      tbody tr:hover td{background:#fff !important;}
      thead th{background:#efefef !important;-webkit-print-color-adjust:exact;print-color-adjust:exact;}
      tbody td{border:1px solid #aaa !important;padding:6px 8px !important;overflow:hidden !important;vertical-align:middle !important;font-size:12px !important;}
      th:last-child,td:last-child{display:none !important;}
      input,textarea,select{border:0 !important;padding:0 !important;font-size:12px !important;background:transparent !important;-webkit-appearance:none;appearance:none;box-shadow:none !important;}
      .row{grid-template-columns:130px 1fr !important;gap:5px !important;align-items:center !important;margin:5px 0 !important;}
      .sum{grid-template-columns:1fr !important;}
      .sum-box{width:260px;margin-left:auto;background:#fff !important;box-shadow:none !important;}
      .mode-badge{-webkit-print-color-adjust:exact;print-color-adjust:exact;}
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>
</head>
<body>

<div id="loginScreen">
  <div class="login-deco"></div>
  <div class="login-box">
    <img src="cleon-logo.PNG" alt="Cleon arts and trade" class="login-logo" onerror="this.style.display='none'" />
    <div class="login-title">ClÃ©on arts &amp; trade</div>
    <div class="login-subtitle">Delivery Note System</div>
    <div class="login-field">
      <input type="password" id="pwInput" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" autocomplete="current-password" />
      <button class="toggle-pw" type="button" id="togglePw" aria-label="show password">ğŸ‘</button>
    </div>
    <button class="login-btn" id="loginBtn" type="button">ãƒ­ã‚°ã‚¤ãƒ³</button>
    <div class="login-error" id="loginError"></div>
    <div class="login-hint">ã“ã®ãƒšãƒ¼ã‚¸ã¯ClÃ©on arts &amp; trade ã®ä½œè€…ã•ã¾å°‚ç”¨ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚<br>ãŠå¿ƒå½“ãŸã‚Šã®ãªã„æ–¹ã¯ã€ãã£ã¨ãƒšãƒ¼ã‚¸ã‚’ãŠé–‰ã˜ãã ã•ã„ã€‚</div>
  </div>
</div>

<div id="mainApp">
<div class="wrap">
  <div class="topbar">
    <div class="brand">
      <img src="cleon-logo.PNG" alt="Cleon" class="logo" onerror="this.style.display='none'" />
      <div class="brand-text">
        <h1>ç´å“æ›¸</h1>
        <div class="sub">æ¾„å’Œå‰µè—åˆåŒä¼šç¤¾ã€€|ã€€Delivery Note</div>
      </div>
    </div>
    <div class="actions">
      <button type="button" class="btn-mini" id="clearBtn">ãƒªã‚»ãƒƒãƒˆ</button>
      <button type="button" class="primary btn-mini" id="pdfBtn">ğŸ“„ PDFã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
      <button type="button" class="btn-mini" id="printBtn">ğŸ–¨ å°åˆ·</button>
      <span class="hint" id="pdfHint"></span>
    </div>
  </div>

  <div class="send-banner">
    <div class="send-banner-icon">ğŸ“¬</div>
    <div class="send-banner-body">
      <strong>PDFã‚’ä½œæˆå¾Œã€ä¸‹è¨˜ã„ãšã‚Œã‹ã®æ–¹æ³•ã§ã”é€ä»˜ãã ã•ã„</strong>
      <p>âœ‰ï¸ ãƒ¡ãƒ¼ãƒ«ï¼š<a href="mailto:info@cleonarts.com">info@cleonarts.com</a>ã€€ã€€ğŸ’¬ LINEã«ã¦ãã®ã¾ã¾ãŠé€ã‚Šã„ãŸã ã„ã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚<br>ã”ä¸æ˜ãªç‚¹ã¯ãŠæ°—è»½ã«ã”é€£çµ¡ãã ã•ã„ã€‚</p>
    </div>
    <div class="send-banner-actions">
      <button class="copy-btn" id="copyMailBtn" type="button">ğŸ“‹ ãƒ¡ãƒ¼ãƒ«ã‚’ã‚³ãƒ”ãƒ¼</button>
      <a href="mailto:info@cleonarts.com?subject=ç´å“æ›¸ã®é€ä»˜" style="text-decoration:none;">
        <button class="copy-btn" type="button" style="color:#059669;border-color:#a7f3d0;">âœ‰ï¸ ãƒ¡ãƒ¼ãƒ«ã‚’é–‹ã</button>
      </a>
      <a href="https://line.me/ti/p/VAi214o7YN" target="_blank" style="text-decoration:none;">
  <button class="copy-btn" type="button" style="color:#06c755;border-color:#06c755;">ğŸ’¬ LINEã§é€ã‚‹</button>
     </a>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <div class="sec-title"><h2>åŸºæœ¬æƒ…å ±</h2><div class="small">å¿…è¦äº‹é …ã‚’ã”å…¥åŠ›ãã ã•ã„</div></div>
      <div class="row"><label>å®›å…ˆ</label><div class="dest-box"><div class="dest-name">æ¾„å’Œå‰µè—åˆåŒä¼šç¤¾</div><div class="dest-addr">ã€’185-0032 æ±äº¬éƒ½å›½åˆ†å¯ºå¸‚æ—¥å‰ç”º2-34-14 2Gå·å®¤</div></div></div>
      <div class="row"><label>ç´å“æ›¸ç•ªå·ï¼ˆä»»æ„ï¼‰</label><input id="docNo" placeholder="ä¾‹ï¼š2026-001" data-ph="ä¾‹ï¼š2026-001" /></div>
      <div class="row"><label>ç´å“æ—¥</label><input id="docDate" type="date" /></div>
      <div class="row"><label>å§“å</label><input id="authorName" placeholder="ä¾‹ï¼šæ¾„å’Œ èŠ±å­" data-ph="ä¾‹ï¼šæ¾„å’Œ èŠ±å­" /></div>
      <div class="row"><label>å±‹å·</label><input id="shopName" placeholder="ä¾‹ï¼šatelier " data-ph="ä¾‹ï¼šatelier " /></div>
      <div class="row"><label>TEL</label><input id="tel" placeholder="ä¾‹ï¼š090-xxxx-xxxx" data-ph="ä¾‹ï¼š090-xxxx-xxxx" /></div>
      <div class="row"><label>ä½æ‰€ï¼ˆä»»æ„ï¼‰</label><textarea id="addr" placeholder="ä¾‹ï¼šã€’xxx-xxxx æ±äº¬éƒ½â€¦" data-ph="ä¾‹ï¼šã€’xxx-xxxx æ±äº¬éƒ½â€¦"></textarea></div>
      <div class="pill">
        <span style="font-size:13px;font-weight:700;color:var(--muted);">å…¥åŠ›æ–¹å¼ï¼š</span>
        <select id="mode">
          <option value="taxin" selected>ç¨è¾¼ï¼ˆ10%è¾¼ï¼‰</option>
          <option value="taxex">ç¨æŠœï¼ˆ10%åˆ¥ï¼‰</option>
          <option value="totalnone">ç·é¡ï¼ˆç¨åŒºåˆ†ãªã—ï¼‰</option>
        </select>
      </div>
      <div class="footer-note">
        â€»ã€Œç¨è¾¼ã€ã€Œç¨æŠœã€ã®ã©ã¡ã‚‰ã‹åˆ†ã‹ã‚‹å ´åˆã¯è©²å½“ã™ã‚‹æ–¹ã‚’ãŠé¸ã³ãã ã•ã„ã€‚<br/>
        â€»ç¨åŒºåˆ†ã®è¨˜è¼‰ãŒãªã„å ´åˆã¯ã€Œç·é¡ï¼ˆç¨åŒºåˆ†ãªã—ï¼‰ã€ã‚’ã”é¸æŠã„ãŸã ã‘ã¾ã™ã€‚ãã®å ´åˆã€å…¥åŠ›ã„ãŸã ã„ãŸé‡‘é¡ã‚’ãã®ã¾ã¾ç²¾ç®—åŸºæº–é¡ã¨ã—ã¦æ‰±ã„ã¾ã™ã€‚<br/>
        â€»å½“ãƒ•ã‚©ãƒ¼ãƒ ã¯ClÃ©onå°‚ç”¨ã®å†…éƒ¨ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚å…¥åŠ›æƒ…å ±ã¯å¤–éƒ¨ã¸å…¬é–‹ã•ã‚Œã¾ã›ã‚“ã®ã§ã”å®‰å¿ƒãã ã•ã„ã€‚
      </div>
    </div>

    <div class="card">
      <div class="sec-title"><h2>æ˜ç´°</h2><div class="small">å˜ä¾¡ Ã— æ•°é‡ â†’ é‡‘é¡ï¼ˆè‡ªå‹•è¨ˆç®—ï¼‰</div></div>
      <div class="table-wrap">
        <table id="itemsTable">
          <colgroup><col class="no"><col class="name"><col class="unit"><col class="qty"><col class="amount"><col class="del"></colgroup>
          <thead><tr><th class="center">No</th><th>å“å / ä½œå“å</th><th class="num">å˜ä¾¡</th><th class="num">æ•°é‡</th><th class="num">é‡‘é¡</th><th class="center">å‰Šé™¤</th></tr></thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
      <div class="table-actions"><button type="button" class="btn-mini" id="addRowBtn">ï¼‹ è¿½åŠ </button></div>
      <div class="sum">
        <div class="footer-note">
          â€» é‡‘é¡ã¯è‡ªå‹•è¨ˆç®—ã§ã™ã€‚ã€ŒPDFã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ã§PDFãŒä½œæˆã§ãã¾ã™ã€‚<br/>
          â€» ç¨è¾¼å…¥åŠ›æ™‚ï¼šåˆè¨ˆã¯å…¥åŠ›é‡‘é¡ã®åˆç®—ã€å†…è¨³ã¨ã—ã¦å°è¨ˆã¨å†…æ¶ˆè²»ç¨ã‚’ç®—å‡ºã—ã¾ã™ã€‚
        </div>
        <div class="sum-box">
          <div class="sum-row"><div class="k">å…¥åŠ›æ–¹å¼</div><div class="v"><span class="mode-badge" id="modeBadge">ç¨è¾¼ï¼ˆ10%è¾¼ï¼‰</span></div></div>
          <div class="sum-row"><div class="k">å°è¨ˆ</div><div class="v" id="subTotal">0 å††</div></div>
          <div class="sum-row" id="taxRow"><div class="k">ã†ã¡æ¶ˆè²»ç¨</div><div class="v" id="tax">0 å††</div></div>
          <div class="sum-row grand"><div class="k">åˆè¨ˆ</div><div class="v" id="grandTotal">0 å††</div></div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<script>
const PASS = "cleon2026nhtool";
function tryLogin(){
  if(document.getElementById("pwInput").value===PASS){
    document.getElementById("loginScreen").classList.add("hide");
    document.getElementById("mainApp").classList.add("show");
    setTimeout(()=>{document.getElementById("loginScreen").style.display="none";},700);
  } else {
    const err=document.getElementById("loginError");
    err.textContent="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚";
    document.getElementById("pwInput").value="";
    document.getElementById("pwInput").focus();
    setTimeout(()=>{err.textContent="";},3000);
  }
}
document.getElementById("loginBtn").addEventListener("click",tryLogin);
document.getElementById("pwInput").addEventListener("keydown",e=>{if(e.key==="Enter")tryLogin();});
document.getElementById("togglePw").addEventListener("click",()=>{
  const i=document.getElementById("pwInput"); i.type=i.type==="password"?"text":"password";
});

document.getElementById("copyMailBtn").addEventListener("click",function(){
  navigator.clipboard.writeText("info@cleonarts.com").then(()=>{
    this.textContent="âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"; this.classList.add("copied");
    setTimeout(()=>{this.textContent="ğŸ“‹ ãƒ¡ãƒ¼ãƒ«ã‚’ã‚³ãƒ”ãƒ¼"; this.classList.remove("copied");},2500);
  }).catch(()=>{ prompt("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„:","info@cleonarts.com"); });
});

const FONT_REG_URL="./NotoSansJP-Regular.ttf";
const FONT_BOLD_URL="./NotoSansJP-Bold.ttf";
const LOGO_URL="./cleon-logo.PNG";

const yen=n=>(Number.isFinite(n)?n:0).toLocaleString("ja-JP")+" å††";
const toInt=v=>{const n=Number(String(v??"").replace(/[^\d.-]/g,""));return Number.isFinite(n)?n:0;};
const roundY=n=>Math.round(n);
const _phBackup=new Map();
function clearPH(){document.querySelectorAll("[data-ph],input.name,input.unit,input.qty").forEach(el=>{_phBackup.set(el,el.getAttribute("placeholder")||"");el.setAttribute("placeholder","");});}
function restorePH(){_phBackup.forEach((v,el)=>{try{el.setAttribute("placeholder",v);}catch(e){}});_phBackup.clear();}
function checkMobile(){if(window.innerWidth<=620)document.body.classList.add("is-mobile");else document.body.classList.remove("is-mobile");}
checkMobile(); window.addEventListener("resize",checkMobile);

const tbody=document.getElementById("tbody");
const modeSel=document.getElementById("mode");
const subTotalEl=document.getElementById("subTotal");
const taxEl=document.getElementById("tax");
const taxRowEl=document.getElementById("taxRow");
const grandTotalEl=document.getElementById("grandTotal");

function makeRow(i){
  const tr=document.createElement("tr");
  tr.innerHTML=`<td class="center no">${i}</td><td class="namecell"><input class="name" placeholder="ä¾‹ï¼šã‚«ãƒƒãƒ—ã‚·ãƒ§ãƒ¼ãƒˆã‚±ãƒ¼ã‚­ / ãƒ–ãƒ­ãƒ¼ãƒ ãªã©" /></td><td class="num unitcell"><input class="unit" inputmode="numeric" placeholder="0" /></td><td class="num qtycell"><input class="qty" inputmode="numeric" placeholder="1" value="1" /></td><td class="num amount">0 å††</td><td class="center"><button type="button" class="btn-mini del" style="color:#c0392b;border-color:#fad7d7;background:#fff9f9;">Ã—</button></td>`;
  tr.querySelector(".del").addEventListener("click",()=>{tr.remove();renumber();recalc();});
  tr.querySelectorAll("input").forEach(inp=>inp.addEventListener("input",recalc));
  return tr;
}
function renumber(){[...tbody.querySelectorAll("tr")].forEach((tr,i)=>{tr.querySelector(".no").textContent=i+1;});}
function addRows(n){const start=tbody.querySelectorAll("tr").length;for(let k=0;k<n;k++)tbody.appendChild(makeRow(start+k+1));recalc();}
function recalc(){
  let sum=0;
  [...tbody.querySelectorAll("tr")].forEach(tr=>{
    const unit=toInt(tr.querySelector(".unit").value);
    const qty=Math.max(0,toInt(tr.querySelector(".qty").value||0));
    const amt=roundY(unit*qty);
    tr.querySelector(".amount").textContent=yen(amt);
    sum+=amt;
  });
  const rate=0.10; const mode=modeSel.value;
  const badge=document.getElementById("modeBadge");
  if(mode==="taxex"){badge.textContent="ç¨æŠœï¼ˆ10%åˆ¥ï¼‰";badge.className="mode-badge taxex";}
  else if(mode==="totalnone"){badge.textContent="ç·é¡ï¼ˆç¨åŒºåˆ†ãªã—ï¼‰";badge.className="mode-badge totalnone";}
  else{badge.textContent="ç¨è¾¼ï¼ˆ10%è¾¼ï¼‰";badge.className="mode-badge";}
  if(mode==="totalnone"){
    taxRowEl.style.display="none";
    const total=roundY(sum);
    subTotalEl.textContent=yen(total); taxEl.textContent=yen(0); grandTotalEl.textContent=yen(total);
  } else {
    taxRowEl.style.display="";
    if(mode==="taxex"){const sub=roundY(sum);const tax=roundY(sub*rate);subTotalEl.textContent=yen(sub);taxEl.textContent=yen(tax);grandTotalEl.textContent=yen(sub+tax);}
    else{const total=roundY(sum);const sub=roundY(total/(1+rate));const tax=total-sub;subTotalEl.textContent=yen(sub);taxEl.textContent=yen(tax);grandTotalEl.textContent=yen(total);}
  }
}
document.getElementById("addRowBtn").addEventListener("click",()=>addRows(1));
modeSel.addEventListener("change",recalc);

document.getElementById("clearBtn").addEventListener("click",()=>{
  if(!confirm("å…¥åŠ›å†…å®¹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ"))return;
  ["docNo","authorName","shopName","tel","addr"].forEach(id=>document.getElementById(id).value="");
  const d=new Date();
  document.getElementById("docDate").value=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
  modeSel.value="taxin"; tbody.innerHTML=""; addRows(6);
});
document.getElementById("printBtn").addEventListener("click",()=>{clearPH();window.print();setTimeout(restorePH,1200);});

function makeName(){
  const no=(document.getElementById("docNo").value||"").trim();
  const au=(document.getElementById("authorName").value||"").trim();
  const dt=(document.getElementById("docDate").value||"").trim();
  const base=no?`ç´å“æ›¸_${no}`:"ç´å“æ›¸";
  const tail=[au,dt].filter(Boolean).join("_");
  return(tail?`${base}_${tail}`:base)+".pdf";
}
function formatNumber(n){return Number(n||0).toLocaleString("ja-JP");}
async function fetchAsBase64(url){
  const res=await fetch(url,{cache:"force-cache"});
  if(!res.ok)throw new Error("fetch failed: "+url+" ("+res.status+")");
  const buf=await res.arrayBuffer();
  let binary=""; const bytes=new Uint8Array(buf); const chunk=0x8000;
  for(let i=0;i<bytes.length;i+=chunk)binary+=String.fromCharCode.apply(null,bytes.subarray(i,i+chunk));
  return btoa(binary);
}
function collectPdfData(){
  const docNo=(document.getElementById("docNo").value||"").trim();
  const docDate=(document.getElementById("docDate").value||"").trim();
  const author=(document.getElementById("authorName").value||"").trim();
  const shop=(document.getElementById("shopName").value||"").trim();
  const tel=(document.getElementById("tel").value||"").trim();
  const addr=(document.getElementById("addr").value||"").trim();
  const rows=[...tbody.querySelectorAll("tr")].map(tr=>({
    no:tr.querySelector(".no").textContent,
    name:(tr.querySelector(".name").value||"").trim(),
    unit:toInt(tr.querySelector(".unit").value),
    qty:Math.max(0,toInt(tr.querySelector(".qty").value||0)),
  })).map(r=>({...r,amt:roundY(r.unit*r.qty)}));
  const mode=modeSel.value; const rate=0.10;
  const sum=roundY(rows.reduce((a,r)=>a+r.amt,0));
  let sub=0,tax=null,total=0;
  if(mode==="totalnone"){total=roundY(sum);sub=total;tax=null;}
  else if(mode==="taxex"){sub=roundY(sum);tax=roundY(sub*rate);total=sub+tax;}
  else{total=roundY(sum);sub=roundY(total/(1+rate));tax=total-sub;}
  return{company:"æ¾„å’Œå‰µè—åˆåŒä¼šç¤¾",toZip:"ã€’185-0032",toAddr:"æ±äº¬éƒ½å›½åˆ†å¯ºå¸‚æ—¥å‰ç”º2-34-14 2Gå·å®¤",docNo,docDate,author,shop,tel,addr,rows,sub,tax,total,mode};
}

async function generatePdfVector(){
  const{jsPDF}=window.jspdf;
  const doc=new jsPDF({unit:"mm",format:"a4"});
  try{const r=await fetchAsBase64(FONT_REG_URL);doc.addFileToVFS("NotoSansJP-Regular.ttf",r);doc.addFont("NotoSansJP-Regular.ttf","NotoSansJP","normal","Identity-H");}
  catch(e){throw new Error("Regular font load failed: "+e.message);}
  try{const b=await fetchAsBase64(FONT_BOLD_URL);doc.addFileToVFS("NotoSansJP-Bold.ttf",b);doc.addFont("NotoSansJP-Bold.ttf","NotoSansJP","bold","Identity-H");}
  catch(e){console.warn("Bold font not available:",e);}
  doc.setFont("NotoSansJP","normal");
  const M=12,W=210;
  let logoLoaded=false;
  try{
    const lb=await fetchAsBase64(LOGO_URL);
    const fmt=LOGO_URL.split('.').pop().toUpperCase()==="PNG"?"PNG":"JPEG";
    await new Promise(resolve=>{
      const img=new Image();
      img.onload=()=>{const tH=14;const tW=(img.naturalWidth/img.naturalHeight)*tH;doc.addImage("data:image/"+fmt.toLowerCase()+";base64,"+lb,fmt,M,10,tW,tH);logoLoaded=true;resolve();};
      img.onerror=()=>resolve();
      img.src="data:image/"+fmt.toLowerCase()+";base64,"+lb;
    });
  }catch(e){console.warn("Logo embed failed:",e);}
  const hX=logoLoaded?50:M;
  doc.setFont("NotoSansJP","bold");doc.setFontSize(22);doc.text("ç´å“æ›¸",hX,18);
  doc.setFont("NotoSansJP","normal");doc.setFontSize(12);doc.setTextColor(85);doc.text("æ¾„å’Œå‰µè—åˆåŒä¼šç¤¾",hX,24);doc.setTextColor(17);
  const data=collectPdfData();
  const infoBody=[["å®›å…ˆ",data.company+"\n"+data.toZip+" "+data.toAddr],["ç´å“æ›¸ç•ªå·",data.docNo||"â€”"],["ç´å“æ—¥",data.docDate||"â€”"],["å§“å",data.author||"â€”"],["å±‹å·",data.shop||"â€”"],["TEL",data.tel||"â€”"]];
  if(data.addr)infoBody.push(["ä½æ‰€",data.addr]);
  doc.autoTable({startY:32,theme:"grid",head:[],body:infoBody,styles:{font:"NotoSansJP",fontStyle:"normal",fontSize:11,cellPadding:2.2,lineColor:170,lineWidth:0.2,valign:"top"},columnStyles:{0:{cellWidth:36,textColor:[85,85,85],fontStyle:"bold"},1:{cellWidth:W-M*2-36}},margin:{left:M,right:M}});
  const sY=doc.lastAutoTable.finalY+6;
  const ib=data.rows.map(r=>([String(r.no),r.name||"",formatNumber(r.unit),formatNumber(r.qty),formatNumber(r.amt)+" å††"]));
  while(ib.length<6)ib.push([String(ib.length+1),"","","","0 å††"]);
  const cNo=12,cUnit=32,cQty=20,cAmt=36,cName=(W-M*2)-(cNo+cUnit+cQty+cAmt);
  doc.autoTable({startY:sY,theme:"grid",head:[["No","å“å / ä½œå“å","å˜ä¾¡","æ•°é‡","é‡‘é¡"]],body:ib,styles:{font:"NotoSansJP",fontStyle:"normal",fontSize:11,cellPadding:2.0,lineColor:170,lineWidth:0.2,valign:"middle"},headStyles:{fillColor:[239,239,239],textColor:17,fontStyle:"bold"},columnStyles:{0:{cellWidth:cNo,halign:"center"},1:{cellWidth:cName,halign:"left"},2:{cellWidth:cUnit,halign:"right"},3:{cellWidth:cQty,halign:"right"},4:{cellWidth:cAmt,halign:"right"}},margin:{left:M,right:M}});

  // â”€â”€ åˆè¨ˆãƒœãƒƒã‚¯ã‚¹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ãƒšãƒ¼ã‚¸æ®‹é‡ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€åã¾ã‚‰ãªã‘ã‚Œã°æ”¹ãƒšãƒ¼ã‚¸ã™ã‚‹
  const PAGE_H = 297;       // A4é«˜ã• (mm)
  const BOTTOM_MARGIN = 14; // ä¸‹ç«¯ã®ä½™ç™½ (mm)
  const isTN = data.mode === "totalnone";
  const lH = 8;
  const nR = isTN ? 3 : 4;
  const bH = lH * nR + (nR === 3 ? 6 : 8);
  const BOX_GAP = 8; // è¡¨ã¨ã®é–“éš”

  let lY = doc.lastAutoTable.finalY;

  // åˆè¨ˆãƒœãƒƒã‚¯ã‚¹ã«å¿…è¦ãªé«˜ã• = ã‚®ãƒ£ãƒƒãƒ— + ãƒœãƒƒã‚¯ã‚¹é«˜ã• + ä¸‹ãƒãƒ¼ã‚¸ãƒ³
  const neededH = BOX_GAP + bH + BOTTOM_MARGIN;

  // ç¾åœ¨ãƒšãƒ¼ã‚¸ã®æ®‹ã‚Šé«˜ã•ãŒè¶³ã‚Šãªã‘ã‚Œã°æ”¹ãƒšãƒ¼ã‚¸
  if (lY + neededH > PAGE_H) {
    doc.addPage();
    lY = M; // æ–°ãƒšãƒ¼ã‚¸ã®å…ˆé ­ãƒãƒ¼ã‚¸ãƒ³
  }

  const ml=isTN?"ç·é¡ï¼ˆç¨åŒºåˆ†ãªã—ï¼‰":data.mode==="taxex"?"ç¨æŠœï¼ˆ10%åˆ¥ï¼‰":"ç¨è¾¼ï¼ˆ10%è¾¼ï¼‰";
  const bW=86,bX=W-M-bW,bY=lY+BOX_GAP;

  doc.setDrawColor(204);doc.roundedRect(bX,bY,bW,bH,2,2);
  doc.setDrawColor(224);doc.line(bX,bY+lH+2,bX+bW,bY+lH+2);
  if(isTN){
    doc.line(bX,bY+lH*2+4,bX+bW,bY+lH*2+4);
    doc.setFont("NotoSansJP","bold");doc.setTextColor(120);doc.setFontSize(9.5);
    doc.text("å˜ä¾¡å…¥åŠ›æ–¹å¼",bX+4,bY+lH-1);doc.text(ml,bX+bW-4,bY+lH-1,{align:"right"});
    doc.setTextColor(17);doc.setFontSize(10.5);
    [{label:"ãŠæ”¯æ‰•ã„é‡‘é¡",value:formatNumber(data.sub)+" å††"},{label:"åˆè¨ˆ",value:formatNumber(data.total)+" å††"}].forEach((r,i)=>{const y=bY+lH*(i+1)+lH-1+(i*2);doc.text(r.label,bX+4,y);doc.text(r.value,bX+bW-4,y,{align:"right"});});
  } else {
    doc.line(bX,bY+lH*2+4,bX+bW,bY+lH*2+4);doc.line(bX,bY+lH*3+6,bX+bW,bY+lH*3+6);
    doc.setFont("NotoSansJP","bold");doc.setTextColor(120);doc.setFontSize(9.5);
    doc.text("å˜ä¾¡å…¥åŠ›æ–¹å¼",bX+4,bY+lH-1);doc.text(ml,bX+bW-4,bY+lH-1,{align:"right"});
    doc.setTextColor(17);doc.setFontSize(10.5);
    [{label:"å°è¨ˆ",value:formatNumber(data.sub)+" å††"},{label:"ã†ã¡æ¶ˆè²»ç¨",value:formatNumber(data.tax)+" å††"},{label:"åˆè¨ˆ",value:formatNumber(data.total)+" å††"}].forEach((r,i)=>{const y=bY+lH*(i+1)+lH-1+(i*2);doc.text(r.label,bX+4,y);doc.text(r.value,bX+bW-4,y,{align:"right"});});
  }
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  doc.save(makeName());
}

async function handlePDF(){
  const btn=document.getElementById("pdfBtn"),hint=document.getElementById("pdfHint");
  btn.disabled=true;hint.textContent="PDFã‚’ä½œæˆä¸­â€¦";clearPH();
  try{await generatePdfVector();hint.textContent="";}
  catch(e){console.error(e);alert("PDFä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n\nã‚¨ãƒ©ãƒ¼: "+e.message);}
  finally{restorePH();btn.disabled=false;setTimeout(()=>{hint.textContent="";},4000);}
}
document.getElementById("pdfBtn").addEventListener("click",handlePDF);

const d=new Date();
document.getElementById("docDate").value=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
addRows(6);
</script>
</body>
</html>
